"use strict";(globalThis.webpackChunkc_users_us_er_project_unicorn_docs=globalThis.webpackChunkc_users_us_er_project_unicorn_docs||[]).push([[268],{7258(n,e,t){t.r(e),t.d(e,{default:()=>f});var s=t(6540),i=t(1656),a=t(3611),r=t(4848);const o=(0,a.UU)("https://lpaqjhrjuokvhsdegynn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxwYXFqaHJqdW9rdmhzZGVneW5uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NjIxMzgsImV4cCI6MjA4MDIzODEzOH0.VtWNvXB8mMhOeg9GOwd3s6MjwxDjoMbS5cOW4wLe7WQ"),d="#0084FF",c="#F0F2F5",l="#E4E6EB",h="#050505",p="#65676B",x="#FFFFFF",g="#31A24C",m=`\n  .messenger-chat {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n    display: flex;\n    height: calc(100vh - 60px);\n    background: ${x};\n  }\n  \n  /* Sidebar - Conversation List */\n  .chat-sidebar {\n    width: 360px;\n    border-right: 1px solid ${l};\n    display: flex;\n    flex-direction: column;\n  }\n  .sidebar-header {\n    padding: 16px;\n    border-bottom: 1px solid ${l};\n  }\n  .sidebar-header h2 {\n    margin: 0;\n    font-size: 24px;\n    font-weight: 700;\n  }\n  .conversation-list {\n    flex: 1;\n    overflow-y: auto;\n  }\n  .conversation-item {\n    display: flex;\n    align-items: center;\n    padding: 10px 16px;\n    cursor: pointer;\n    transition: background 0.2s;\n  }\n  .conversation-item:hover {\n    background: ${c};\n  }\n  .conversation-item.active {\n    background: ${l};\n  }\n  .avatar {\n    width: 56px;\n    height: 56px;\n    border-radius: 50%;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-weight: 600;\n    font-size: 20px;\n    margin-right: 12px;\n    position: relative;\n  }\n  .avatar img {\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n    object-fit: cover;\n  }\n  .online-dot {\n    position: absolute;\n    bottom: 2px;\n    right: 2px;\n    width: 14px;\n    height: 14px;\n    background: ${g};\n    border: 3px solid white;\n    border-radius: 50%;\n  }\n  .conversation-info {\n    flex: 1;\n    min-width: 0;\n  }\n  .conversation-name {\n    font-weight: 600;\n    color: ${h};\n    margin-bottom: 4px;\n  }\n  .conversation-preview {\n    color: ${p};\n    font-size: 13px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n  .conversation-time {\n    font-size: 12px;\n    color: ${p};\n  }\n  .unread-badge {\n    background: ${d};\n    color: white;\n    font-size: 12px;\n    font-weight: 600;\n    padding: 2px 8px;\n    border-radius: 10px;\n    margin-left: 8px;\n  }\n  \n  /* Main Chat Area */\n  .chat-main {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    background: ${x};\n  }\n  .chat-header {\n    padding: 12px 16px;\n    border-bottom: 1px solid ${l};\n    display: flex;\n    align-items: center;\n  }\n  .chat-header .avatar {\n    width: 40px;\n    height: 40px;\n    font-size: 16px;\n    margin-right: 12px;\n  }\n  .chat-header-info h3 {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n  }\n  .chat-header-status {\n    font-size: 12px;\n    color: ${g};\n  }\n  \n  /* Messages Area */\n  .messages-container {\n    flex: 1;\n    overflow-y: auto;\n    padding: 16px;\n    display: flex;\n    flex-direction: column;\n  }\n  .message-group {\n    display: flex;\n    margin-bottom: 8px;\n  }\n  .message-group.me {\n    justify-content: flex-end;\n  }\n  .message-group .avatar {\n    width: 28px;\n    height: 28px;\n    font-size: 12px;\n    margin-right: 8px;\n    flex-shrink: 0;\n  }\n  .message-group.me .avatar {\n    display: none;\n  }\n  .message-bubble {\n    max-width: 65%;\n    padding: 8px 12px;\n    border-radius: 18px;\n    font-size: 15px;\n    line-height: 1.4;\n  }\n  .message-group:not(.me) .message-bubble {\n    background: ${"#E4E6EB"};\n    color: ${h};\n  }\n  .message-group.me .message-bubble {\n    background: ${"#0084FF"};\n    color: white;\n  }\n  .message-time {\n    font-size: 11px;\n    color: ${p};\n    margin-top: 4px;\n    text-align: right;\n  }\n  .message-group.me .message-time {\n    text-align: right;\n  }\n  \n  /* Typing Indicator */\n  .typing-indicator {\n    display: flex;\n    align-items: center;\n    padding: 8px 12px;\n    background: ${l};\n    border-radius: 18px;\n    width: fit-content;\n  }\n  .typing-dot {\n    width: 8px;\n    height: 8px;\n    background: ${p};\n    border-radius: 50%;\n    margin: 0 2px;\n    animation: typing 1.4s infinite;\n  }\n  .typing-dot:nth-child(2) { animation-delay: 0.2s; }\n  .typing-dot:nth-child(3) { animation-delay: 0.4s; }\n  @keyframes typing {\n    0%, 60%, 100% { transform: translateY(0); }\n    30% { transform: translateY(-4px); }\n  }\n  \n  /* Input Area */\n  .chat-input-area {\n    padding: 12px 16px;\n    border-top: 1px solid ${l};\n    display: flex;\n    align-items: center;\n    gap: 12px;\n  }\n  .chat-input {\n    flex: 1;\n    padding: 10px 16px;\n    border: none;\n    background: ${c};\n    border-radius: 20px;\n    font-size: 15px;\n    outline: none;\n  }\n  .chat-input:focus {\n    background: ${l};\n  }\n  .send-btn {\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: ${d};\n    border: none;\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.2s;\n  }\n  .send-btn:hover {\n    transform: scale(1.1);\n  }\n  .send-btn:disabled {\n    background: ${l};\n    cursor: not-allowed;\n  }\n  \n  /* Emoji & Attachments */\n  .action-btn {\n    width: 36px;\n    height: 36px;\n    border-radius: 50%;\n    background: transparent;\n    border: none;\n    color: ${d};\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 20px;\n  }\n  .action-btn:hover {\n    background: ${c};\n  }\n  \n  /* Reactions */\n  .reactions-bar {\n    display: flex;\n    gap: 4px;\n    margin-top: 4px;\n  }\n  .reaction {\n    background: ${c};\n    padding: 2px 6px;\n    border-radius: 10px;\n    font-size: 12px;\n    cursor: pointer;\n  }\n  .reaction:hover {\n    background: ${l};\n  }\n  \n  /* Empty State */\n  .empty-state {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    color: ${p};\n  }\n  .empty-state-icon {\n    font-size: 64px;\n    margin-bottom: 16px;\n  }\n  \n  /* Search */\n  .search-box {\n    width: 100%;\n    padding: 10px 16px;\n    border: none;\n    background: ${c};\n    border-radius: 20px;\n    font-size: 14px;\n    outline: none;\n    margin-top: 12px;\n  }\n`;function u({message:n,isMe:e}){return(0,r.jsxs)("div",{className:"message-group "+(e?"me":""),children:[!e&&(0,r.jsx)("div",{className:"avatar",children:n.sender_name?.charAt(0)||"?"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"message-bubble",children:n.content}),(0,r.jsxs)("div",{className:"message-time",children:[(t=n.created_at,new Date(t).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"})),e&&n.is_read&&" \u2713\u2713"]}),n.reactions&&Object.keys(n.reactions).length>0&&(0,r.jsx)("div",{className:"reactions-bar",children:Object.entries(n.reactions).map(([n,e])=>(0,r.jsxs)("span",{className:"reaction",children:[n," ",e]},n))})]})]});var t}function b({userName:n}){return(0,r.jsxs)("div",{className:"message-group",children:[(0,r.jsx)("div",{className:"avatar",style:{width:28,height:28,fontSize:12},children:n?.charAt(0)||"?"}),(0,r.jsxs)("div",{className:"typing-indicator",children:[(0,r.jsx)("div",{className:"typing-dot"}),(0,r.jsx)("div",{className:"typing-dot"}),(0,r.jsx)("div",{className:"typing-dot"})]})]})}function f(){const[n,e]=(0,s.useState)(null),[t,a]=(0,s.useState)([]),[l,h]=(0,s.useState)(null),[x,g]=(0,s.useState)([]),[f,v]=(0,s.useState)(""),[j,y]=(0,s.useState)(!1),[w,N]=(0,s.useState)([]),k=(0,s.useRef)(null);(0,s.useEffect)(()=>{_();const n=o.channel("messages-realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},n=>{n.new.conversation_id===l?.id&&g(e=>[...e,n.new])}).subscribe();return()=>{o.removeChannel(n)}},[l]),(0,s.useEffect)(()=>{k.current?.scrollIntoView({behavior:"smooth"})},[x]);const _=async()=>{const{data:{session:n}}=await o.auth.getSession();n?.user&&(e(n.user),$(n.user.id))},$=async n=>{const{data:e,error:t}=await o.from("conversations").select("*").contains("participant_ids",[n]).order("last_message_at",{ascending:!1});!t&&e&&a(e)},z=n=>{h(n),(async n=>{const{data:e,error:t}=await o.from("messages").select("*").eq("conversation_id",n).eq("is_deleted",!1).order("created_at",{ascending:!0});!t&&e&&g(e)})(n.id)},I=async()=>{if(!f.trim()||!l)return;const e={conversation_id:l.id,sender_id:n.id,content:f.trim(),message_type:"text"},{error:t}=await o.from("messages").insert(e);t||(v(""),await o.from("conversations").update({last_message_at:(new Date).toISOString()}).eq("id",l.id))};return n?(0,r.jsxs)(i.A,{title:"Messenger",children:[(0,r.jsx)("style",{children:m}),(0,r.jsxs)("div",{className:"messenger-chat",children:[(0,r.jsxs)("div",{className:"chat-sidebar",children:[(0,r.jsxs)("div",{className:"sidebar-header",children:[(0,r.jsx)("h2",{children:"\ud83d\udcac \u0e41\u0e0a\u0e17"}),(0,r.jsx)("input",{type:"text",className:"search-box",placeholder:"\ud83d\udd0d \u0e04\u0e49\u0e19\u0e2b\u0e32 Messenger"})]}),(0,r.jsx)("div",{className:"conversation-list",children:0===t.length?(0,r.jsx)("div",{style:{padding:20,textAlign:"center",color:p},children:"\u0e22\u0e31\u0e07\u0e44\u0e21\u0e48\u0e21\u0e35\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32"}):t.map(n=>(0,r.jsxs)("div",{className:"conversation-item "+(l?.id===n.id?"active":""),onClick:()=>z(n),children:[(0,r.jsxs)("div",{className:"avatar",children:[n.title?.charAt(0)||"\ud83d\udcac",(0,r.jsx)("div",{className:"online-dot"})]}),(0,r.jsxs)("div",{className:"conversation-info",children:[(0,r.jsx)("div",{className:"conversation-name",children:n.title||"\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32"}),(0,r.jsxs)("div",{className:"conversation-preview",children:["rental"===n.type&&"\ud83d\ude97 ","\u0e04\u0e25\u0e34\u0e01\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e14\u0e39\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21"]})]}),(0,r.jsx)("div",{className:"conversation-time",children:new Date(n.last_message_at).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"})})]},n.id))})]}),(0,r.jsx)("div",{className:"chat-main",children:l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"chat-header",children:[(0,r.jsx)("div",{className:"avatar",children:l.title?.charAt(0)||"\ud83d\udcac"}),(0,r.jsxs)("div",{className:"chat-header-info",children:[(0,r.jsx)("h3",{children:l.title||"\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32"}),(0,r.jsx)("div",{className:"chat-header-status",children:"rental"===l.type?"\ud83d\ude97 \u0e01\u0e32\u0e23\u0e40\u0e0a\u0e48\u0e32\u0e23\u0e16":"\u25cf \u0e2d\u0e2d\u0e19\u0e44\u0e25\u0e19\u0e4c"})]})]}),(0,r.jsxs)("div",{className:"messages-container",children:[x.map(e=>(0,r.jsx)(u,{message:e,isMe:e.sender_id===n.id},e.id)),w.length>0&&(0,r.jsx)(b,{userName:w[0]}),(0,r.jsx)("div",{ref:k})]}),(0,r.jsxs)("div",{className:"chat-input-area",children:[(0,r.jsx)("button",{className:"action-btn",children:"\u2795"}),(0,r.jsx)("button",{className:"action-btn",children:"\ud83d\udcf7"}),(0,r.jsx)("button",{className:"action-btn",children:"\ud83c\udfa4"}),(0,r.jsx)("input",{type:"text",className:"chat-input",placeholder:"Aa",value:f,onChange:n=>v(n.target.value),onKeyPress:n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),I())}}),(0,r.jsx)("button",{className:"action-btn",children:"\ud83d\ude0a"}),(0,r.jsx)("button",{className:"send-btn",onClick:I,disabled:!f.trim(),children:"\u27a4"})]})]}):(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-state-icon",children:"\ud83d\udcac"}),(0,r.jsx)("h2",{children:"\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e01\u0e32\u0e23\u0e2a\u0e19\u0e17\u0e19\u0e32"}),(0,r.jsx)("p",{children:"\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e41\u0e0a\u0e17\u0e08\u0e32\u0e01\u0e23\u0e32\u0e22\u0e01\u0e32\u0e23\u0e17\u0e32\u0e07\u0e0b\u0e49\u0e32\u0e22\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e23\u0e34\u0e48\u0e21\u0e2a\u0e19\u0e17\u0e19\u0e32"})]})})]})]}):(0,r.jsxs)(i.A,{title:"Messenger",children:[(0,r.jsx)("style",{children:m}),(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"calc(100vh - 60px)",background:c},children:(0,r.jsxs)("div",{style:{background:"white",padding:40,borderRadius:12,textAlign:"center",maxWidth:400},children:[(0,r.jsx)("div",{style:{fontSize:64,marginBottom:16},children:"\ud83d\udcac"}),(0,r.jsx)("h1",{style:{marginBottom:8},children:"GTS Messenger"}),(0,r.jsx)("p",{style:{color:p,marginBottom:24},children:"\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e23\u0e30\u0e1a\u0e1a\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e23\u0e34\u0e48\u0e21\u0e41\u0e0a\u0e17"}),(0,r.jsx)("button",{onClick:()=>o.auth.signInWithOAuth({provider:"google"}),style:{width:"100%",padding:"12px 24px",background:d,color:"white",border:"none",borderRadius:20,fontSize:16,fontWeight:600,cursor:"pointer"},children:"\ud83d\udd10 \u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e23\u0e30\u0e1a\u0e1a\u0e14\u0e49\u0e27\u0e22 Google"})]})})]})}}}]);